{% comment %}
  Renders product buy-buttons.
  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} product form id.
  - section_id: {String} id of section to which this snippet belongs.
  - show_pickup_availability: {Boolean} for the pickup availability. If true the pickup availability is rendered, false - not rendered (optional).

  Usage:
  {% render 'buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id, show_pickup_availability: true %}
{% endcomment %}
<script>
  // ページ読み込み時に実行
  document.addEventListener('DOMContentLoaded', function() {
    // ラジオボタンの要素を取得
    var radios = document.querySelectorAll('input[type="radio"]');
    
    // ラジオボタンの状態に応じてクラスを操作する関数
    function updateCheckedState() {
      radios.forEach(function(radio) {
        var label = radio.closest('.c_radio-button');
        if (label) {
          if (radio.checked) {
            label.classList.add('js-checked'); // ラジオボタンがチェックされている場合は .js-checked クラスを追加
          } else {
            label.classList.remove('js-checked'); // ラジオボタンがチェックされていない場合は .js-checked クラスを削除
          }
        }
      });
    }

    // 初期状態でチェックされているラジオボタンの親要素に .js-checked クラスを追加する
    updateCheckedState();

    // ラジオボタンの変更イベントを監視せずに、定期的にラジオボタンの状態を確認し、クラスを更新する
    setInterval(updateCheckedState, 100); // 100ミリ秒ごとに状態を確認
  });
</script>

{%- style -%}
  .c_product__quantity-label {
    font-size: 16px;
    margin-bottom: 20px;
  }
  .c_product__quantity-label span {
    font-size: 14px;
  }
  .c_disableBtn_dog {
    opacity: 0.6;
    pointer-events: none;
  }
  .c_disableBtn_cat {
    opacity: 0.6;
    pointer-events: none;
  }
{%- endstyle -%}

<div {{ block.shopify_attributes }}>
  {%- if product != blank -%}
    {%- liquid
      assign gift_card_recipient_feature_active = false
      if block.settings.show_gift_card_recipient and product.gift_card?
        assign gift_card_recipient_feature_active = true
      endif

      assign show_dynamic_checkout = false
      if block.settings.show_dynamic_checkout and gift_card_recipient_feature_active == false
        assign show_dynamic_checkout = true
      endif
    -%}

    <product-form
      class="product-form"
      data-hide-errors="{{ gift_card_recipient_feature_active }}"
      data-section-id="{{ section.id }}"
    >
    
      <div class="product-form__error-message-wrapper" role="alert" hidden>
        <svg
          aria-hidden="true"
          focusable="false"
          class="icon icon-error"
          viewBox="0 0 13 13"
        >
          <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
          <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
          <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
          <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
        </svg>
        <span class="product-form__error-message"></span>
      </div>

      {%- form 'product',
        product,
        id: product_form_id,
        class: 'form',
        novalidate: 'novalidate',
        data-type: 'add-to-cart-form'
      -%}


 <!-- Mikawaya 商品ページウィジェット ver:3 -->
  {% if product.selling_plan_groups.size > 0 %}
    <style>
      .mikawaya-hidden {
        display: none
      }
      .product__price {
        display: none
      }
      .product-single__price {
        display: none
      }
      .mikawaya-radio-button {
        min-height:auto!important;
      }
      .mikawaya-selling-plan-group-container {
        margin-bottom: 20px;
      }
      .mikawaya-selling-plan-description {
        margin-left: 5px;
        margin-top: 5px;
      }
      .mikawaya-selling-plan-select{
        margin-top: 10px;
      }
      .mikawaya-product-page-widget-container {
        width: 100%
      }
    </style>
    
    <!-- Just for initial use --> 
    {%- liquid
      if product.requires_selling_plan or product.selected_selling_plan_allocation
        assign current_selling_plan_allocation = product.selected_or_first_available_selling_plan_allocation
      else
        assign current_selling_plan_allocation = nil
      endif
      
      if product.selling_plan_groups.size > 1 or product.requires_selling_plan == false
        assign show_fieldset = true
      else 
        assign show_fieldset = false
      endif
    -%}
    
    <div id="mikawaya-product-page-widget-container-v3">
    </div>
    
    <div id="mikawaya-product-page-widget-container" class="mikawaya-hidden mikawaya-product-page-widget-container">
    {% if show_fieldset %}
      <fieldset id="mikawaya-fieldset">
        <legend>
            購入オプション
        </legend>
    {% endif %}
    
    {% unless product.requires_selling_plan == true %}
      <div
        class="mikawaya-selling-plan-group-container"
      >
        <input 
          type="radio" 
          name="purchase_option" 
          {% if current_selling_plan_allocation == nil %} checked {% endif %}
          value="one-time"
          onchange="window.MIKAWAYA.handleSellingPlanGroupChange(event)"
          class="mikawaya-radio-button"
          id="one-time-purchase-option"
        >
        通常の購入
        &nbsp;&nbsp;&nbsp;
        {% for variant in product.variants %}
          <span 
            name="one-time-variant-price" 
            data-variant-id="{{ variant.id }}"
            {% unless product.selected_or_first_available_variant.id == variant.id %} 
              class="mikawaya-hidden"
            {% endunless %}
            >{{ variant.price | money }}</span>
        {% endfor %}
      </div>
      {% endunless %}
      
      {% for variant in product.variants %}
        {% for selling_plan_allocation in variant.selling_plan_allocations %}
          <div
            name="variant-group-allocation"
            data-variant-id="{{ variant.id }}"  
            data-group-id="{{ selling_plan_allocation.selling_plan_group_id }}"
            data-selling-plan-id="{{ selling_plan_allocation.selling_plan.id }}"
            data-selling-plan-allocation-price='{{ selling_plan_allocation.price | money }}'
            style="display:hidden"
          ></div>
        {% endfor %}
      {% endfor %}
      
      
      <!-- Selling plan groups -->
      {% for group in product.selling_plan_groups %}
        <div
          name="selling-plan-group-container"
          data-group-id="{{ group.id }}"
          class="mikawaya-selling-plan-group-container mikawaya-hidden"
        >
          <div>
          <input 
            type="radio" 
            value="{{ group.id }}" 
            name="purchase_option"
            onchange="window.MIKAWAYA.handleSellingPlanGroupChange(event)"
            class="mikawaya-radio-button"
            {% if group.id == current_selling_plan_allocation.selling_plan.group_id %} checked {% endif %}
            {% if product.requires_selling_plan and current_selling_plan_allocation == nil and forloop.first %} checked {% endif %}
            >
          <span>{{ group.name }}&nbsp;&nbsp;&nbsp;<span name="group-inline-price" data-group-id="{{ group.id }}"></span></span>
          </div>
          <select 
            name="select-selling-plan"
            data-group-id="{{ group.id }}"
            onchange="window.MIKAWAYA.handleSellingPlanChange(event)"
            class="mikawaya-selling-plan-select"
          >
            <!-- Individual selling plans -->
            {% for selling_plan in group.selling_plans %}
              <option value="{{ selling_plan.id }}">{{ selling_plan.name }}</option>
            {% endfor %}
          </select>
          {% for selling_plan in group.selling_plans %}
            <p 
              name="selling-plan-description" 
              data-group-id="{{ group.id }}"
              data-selling-plan-id="{{ selling_plan.id }}"
              {% if forloop.first %} 
                class="mikawaya-selling-plan-description" 
              {% else %}
                class="mikawaya-selling-plan-description mikawaya-hidden"
              {% endif %}
            >{{ selling_plan.description }}</p>
          {% endfor %}
        </div>
      {% endfor %}
    {% if show_fieldset %}
      </fieldset>
    {% endif %}
    <input 
      type="hidden" 
      name="selling_plan" 
      value="{{ current_selling_plan_allocation.selling_plan.id }}" 
      id="mikawaya-hidden-selling-plan-id"
    >
    <div 
      type="hidden" 
      id="current-variant-id" 
      data-variant-id="{{ product.selected_or_first_available_variant.id }}" 
      class="mikawaya-hidden"
      >
    </div>
    </div>
  {% endif %}


  {% if product.selling_plan_groups.size > 0 %}
<script>
if(Shopify&&Shopify.Checkout&&Shopify.Checkout.hasSellingPlan){Shopify.Checkout.OrderStatus.addContentBox(` <a class="ui-button btn btn--subdued btn--size-small" href="https://${window.location.hostname}/account"> サブスクリプションの管理をする </a> `)}(function(){const _toArray=domCollection=>{return Array.prototype.slice.call(domCollection)};const _sellingPlanInput=document.getElementById("mikawaya-hidden-selling-plan-id");const _setSelectedSellingPlanId=id=>{_sellingPlanInput.value=id;_toArray(document.getElementsByClassName("mikawaya-selling-plan-radio-button")).forEach(el=>{if(el.value===id){el.checked=!0}else{el.checked=!1}})};const _getSelectedSellingPlanGroupId=()=>{return _toArray(document.getElementsByName("purchase_option")).find(el=>el.checked).value};const _getSelectedSellingPlanId=groupId=>{const selectEl=_toArray(document.getElementsByName("select-selling-plan")).find(({dataset})=>dataset.groupId===groupId);return selectEl.value};const handleSellingPlanGroupChange=({target})=>{const groupId=target.value;if(groupId==="one-time"){_setSelectedSellingPlanId("");_renderSellingPlans(groupId)}else{_setSelectedSellingPlanId(_getSelectedSellingPlanId(groupId));_renderSellingPlans(groupId)}};const handleRadioButtonSellingPlanChange=({target})=>{const sellingPlanId=target.value;const{groupId}=target.dataset;_setSelectedSellingPlanId(sellingPlanId);_renderInlinePrices(_getCurrentVariantId());_renderSellingPlanDescription(sellingPlanId,groupId)};const handleSellingPlanChange=({target})=>{const sellingPlanId=target.value;const{groupId}=target.dataset;if(_getSelectedSellingPlanGroupId()===groupId){_setSelectedSellingPlanId(sellingPlanId)} _renderInlinePrices(_getCurrentVariantId());_renderSellingPlanDescription(sellingPlanId,groupId)};const _renderSellingPlans=groupId=>{_toArray(document.getElementsByClassName("mikawaya-selling-plans-container")).forEach(el=>{if(el.dataset.groupId===groupId){el.classList.remove("mikawaya-hidden")}else{el.classList.add("mikawaya-hidden")}})};const _groupVariantAllocation=_toArray(document.getElementsByName("variant-group-allocation")).map(({dataset})=>dataset);const _groupEls=_toArray(document.getElementsByName("selling-plan-group-container"));const _checkGroupInput=groupId=>{_toArray(document.getElementsByName("purchase_option")).find(({value})=>value===groupId).checked=!0};const _handleVariantChange=selectedVariantId=>{const variantSellingPlanGroupIds=[...new Set(_groupVariantAllocation.filter(({variantId})=>variantId==selectedVariantId).map(({groupId})=>groupId))];const oneTimePurchaseEl=document.getElementById("one-time-purchase-option");if(oneTimePurchaseEl){document.getElementById("one-time-purchase-option").checked=!0;_setSelectedSellingPlanId("")} let checkedNew=!1;_groupEls.forEach(groupEl=>{const{dataset}=groupEl;if(variantSellingPlanGroupIds.includes(dataset.groupId)){groupEl.classList.remove("mikawaya-hidden");if(!oneTimePurchaseEl&&!checkedNew){_checkGroupInput(dataset.groupId);_setSelectedSellingPlanId(_getSelectedSellingPlanId(dataset.groupId));checkedNew=!0}}else{groupEl.classList.add("mikawaya-hidden")}});_renderInlinePrices(selectedVariantId)};const _getCurrentVariantId=()=>{const queryParams=new URLSearchParams(location.search);return(queryParams.get("variant")||document.getElementById("current-variant-id").dataset.variantId)};const _listenToVariantChange=()=>{let currentVariantId=_getCurrentVariantId();setInterval(()=>{const splitQueryString=location.search.split("&");const variantKeyIndex=splitQueryString.findIndex(str=>str.includes("variant"));if(variantKeyIndex===-1){return} const queryVariantId=splitQueryString[variantKeyIndex].split("=")[1];if(currentVariantId!==queryVariantId){currentVariantId=queryVariantId;_handleVariantChange(queryVariantId)}},10)};const _renderInlinePrices=variantId=>{_toArray(document.getElementsByName("one-time-variant-price")).forEach(el=>{const{dataset}=el;if(dataset.variantId===variantId){el.classList.remove("mikawaya-hidden")}else{el.classList.add("mikawaya-hidden")}});const inlinePriceEls=_toArray(document.getElementsByName("group-inline-price"));_groupVariantAllocation.filter(dataset=>dataset.variantId===variantId).forEach(dataset=>{const currentSellingPlanId=_getSelectedSellingPlanId(dataset.groupId);if(dataset.sellingPlanId===currentSellingPlanId){const price=dataset.sellingPlanAllocationPrice;inlinePriceEls.find(el=>el.dataset.groupId===dataset.groupId).innerHTML=price}})};const _initGroupsRedner=()=>{const initVariantId=document.getElementById("current-variant-id").dataset.variantId;_handleVariantChange(initVariantId);_renderInlinePrices(initVariantId)};const _renderSellingPlanDescription=(sellingPlanId,groupId)=>{const descriptionEls=_toArray(document.getElementsByName("selling-plan-description"));descriptionEls.find(({dataset})=>dataset.sellingPlanId===sellingPlanId).classList.remove("mikawaya-hidden");descriptionEls.filter(({dataset})=>dataset.sellingPlanId!==sellingPlanId&&dataset.groupId===groupId).forEach(el=>{el.classList.add("mikawaya-hidden")})};const _renderContainer=()=>{document.getElementById("mikawaya-product-page-widget-container").classList.remove("mikawaya-hidden")};if(document.getElementById("mikawaya-product-page-widget-container-v3")){console.log("Hello Mikawaya");_initGroupsRedner();_renderContainer();_listenToVariantChange();window.MIKAWAYA={handleSellingPlanGroupChange,handleSellingPlanChange,handleRadioButtonSellingPlanChange}}})()
    </script>
  {% endif %}


        <input
          type="hidden"
          name="id"
          value="{{ product.selected_or_first_available_variant.id }}"
          {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
            disabled
          {% endif %}
          class="product-variant-id"
        >

        {%- if gift_card_recipient_feature_active -%}
          {%- render 'gift-card-recipient-form', product: product, form: form, section: section -%}
        {%- endif -%}

        {%- comment -%}追記 数量セレクター{%- endcomment -%}

        {% if product.handle contains 'trial' %}
          <p class="c_product__quantity-label">
            数量: 1 <br>
            <span>この商品はおひとり様１つのみの購入となります。</span>
          </p>
        {% else %}
        <div
          id="Quantity-Form-{{ section.id }}"
          class="product-form__input product-form__quantity{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} product-form__quantity-top{% endif %}"
          {{ block.shopify_attributes }}
        >
          {% comment %} TODO: enable theme-check once `item_count_for_variant` is accepted as valid filter {% endcomment %}
          {% # theme-check-disable %}
          {%- assign cart_qty = cart | item_count_for_variant: product.selected_or_first_available_variant.id -%}
          {% # theme-check-enable %}
          <label class="quantity__label form__label" for="Quantity-{{ section.id }}">
            {{ 'products.product.quantity.label' | t }}
          </label>
          <div class="price-per-item__container">
            <quantity-input class="quantity" data-url="{{ product.url }}" data-section="{{ section.id }}">
              <button class="quantity__button no-js-hidden" name="minus" type="button">
                <span class="visually-hidden">
                  {{- 'products.product.quantity.decrease' | t: product: product.title | escape -}}
                </span>
                {% render 'icon-minus' %}
              </button>
              <input
                class="quantity__input"
                type="number"
                name="quantity"
                id="Quantity-{{ section.id }}"
                data-cart-quantity="{{ cart_qty }}"
                data-min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                {% if product.selected_or_first_available_variant.quantity_rule.max != null %}
                  data-max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                  max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                {% endif %}
                step="{{ product.selected_or_first_available_variant.quantity_rule.increment }}"
                value="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                form="{{ product_form_id }}"
              />
              <button class="quantity__button no-js-hidden" name="plus" type="button">
                <span class="visually-hidden">
                  {{- 'products.product.quantity.increase' | t: product: product.title | escape -}}
                </span>
                {% render 'icon-plus' %}
              </button>
            </quantity-input>
            {%- liquid
              assign volume_pricing_array = product.selected_or_first_available_variant.quantity_price_breaks | sort: 'quantity' | reverse
              assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.min
              if cart_qty > 0
                assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.increment
              endif

            -%}
            {%- if product.quantity_price_breaks_configured? -%}
              <price-per-item class="no-js-hidden" id="Price-Per-Item-{{ section.id }}" data-section-id="{{ section.id }}" data-variant-id="{{ product.selected_or_first_available_variant.id }}">
                {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                  {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                  <div class="price-per-item">
                    {%- if variant_price_compare -%}
                      <dl class="price-per-item--current">
                        <dt class="visually-hidden">
                          {{ 'products.product.price.regular_price' | t }}
                        </dt>
                        <dd>
                          <s class="variant-item__old-price">
                            {{ variant_price_compare | money_with_currency }}
                          </s>
                        </dd>
                      </dl>
                    {%- endif -%}
                    {%- if current_qty_for_volume_pricing < volume_pricing_array.last.minimum_quantity -%}
                      {%- assign variant_price = product.selected_or_first_available_variant.price | money_with_currency -%}
                      <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                    {%- else -%}
                      {%- for price_break in volume_pricing_array -%}
                        {%- if current_qty_for_volume_pricing >= price_break.minimum_quantity -%}
                          {%- assign price_break_price = price_break.price | money_with_currency -%}
                          <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: price_break_price }}</span>
                          {%- break -%}
                        {%- endif -%}
                      {%- endfor -%}
                    {%- endif -%}
                  </div>
                {%- else -%}
                  {%- assign variant_price = product.selected_or_first_available_variant.price | money_with_currency -%}
                  {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                  <div class="price-per-item">
                    {%- if variant_price_compare -%}
                      <dl class="price-per-item--current">
                        <dt class="visually-hidden">
                          {{ 'products.product.price.regular_price' | t }}
                        </dt>
                        <dd>
                          <s class="variant-item__old-price">
                            {{ variant_price_compare | money_with_currency }}
                          </s>
                        </dd>
                        <dt class="visually-hidden">
                          {{ 'products.product.price.sale_price' | t }}
                        </dt>
                        <dd>
                          <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                        </dd>
                      </dl>
                    {%- else -%}
                      <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </price-per-item>
            {%- endif -%}
          </div>
          <div class="quantity__rules caption no-js-hidden" id="Quantity-Rules-{{ section.id }}">
            {%- if product.selected_or_first_available_variant.quantity_rule.increment > 1 -%}
              <span class="divider">
                {{-
                  'products.product.quantity.multiples_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.increment
                -}}
              </span>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.quantity_rule.min > 1 -%}
              <span class="divider">
                {{-
                  'products.product.quantity.minimum_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.min
                -}}
              </span>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.quantity_rule.max != null -%}
              <span class="divider">
                {{-
                  'products.product.quantity.maximum_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.max
                -}}
              </span>
            {%- endif -%}
          </div>
          {%- if product.quantity_price_breaks_configured? -%}
            <volume-pricing class="parent-display no-js-hidden" id="Volume-{{ section.id }}">
              {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                <span class="caption-large">{{ 'products.product.volume_pricing.title' | t }}</span>
                <ul class="list-unstyled no-js-hidden">
                  <li>
                    <span>{{ product.selected_or_first_available_variant.quantity_rule.min }}+</span>
                    {%- assign price = product.selected_or_first_available_variant.price | money_with_currency -%}
                    <span data-text="{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}">{{ 'sections.quick_order_list.each' | t: money: price }}</span>
                  </li>
                  {%- for price_break in product.selected_or_first_available_variant.quantity_price_breaks -%}
                    {%- assign price_break_price = price_break.price | money_with_currency -%}
                    <li class="{%- if forloop.index >= 3 -%}show-more-item hidden{%- endif -%}">
                      <span>{{ price_break.minimum_quantity }}<span aria-hidden="true">+</span></span>
                      <span data-text="{{ 'products.product.volume_pricing.price_at_each' | t: price: price_break_price }}">{{ 'sections.quick_order_list.each' | t: money: price_break_price }}</span>
                    </li>
                  {%- endfor -%}
                </ul>
                {%- if product.selected_or_first_available_variant.quantity_price_breaks.size >= 3 -%}
                  <show-more-button>
                    <button
                      class="button-show-more link underlined-link"
                      id="Show-More-{{ section.id }}"
                      type="button"
                    >
                      <span class="label-show-more label-text"
                        ><span aria-hidden="true">+ </span>{{ 'products.facets.show_more' | t }}
                      </span>
                    </button>
                  </show-more-button>
              {%- endif -%}
            {%- endif -%}
            </volume-pricing>
          {%- endif -%}
        </div>
        {% endif %}


        {% for line_item in cart.items %}
          {% if line_item.product.handle contains 'dog-trial' %}
            {% assign variableDog = true %}
          {% endif %}
          {% if line_item.product.handle contains 'cat-trial' %}
            {% assign variableCat = true %}
          {% endif %}
        {% endfor %}


    <!-- 犬用お試し -->
        {% if product.handle contains 'dog-trial'%} 
        <div class="product-form__buttons">
          {%- liquid
            assign check_against_inventory = true
            if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
              assign check_against_inventory = false
            endif
            if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
              assign quantity_rule_soldout = true
            endif
          -%}
          <button
            id="ProductSubmitButton-{{ section_id }}"
            type="submit"
            name="add"
            class="product-form__submit --dog {% if customer.tags contains 'bought-dog-trial' %}c_disableBtn_dog{% endif %} {% if variableDog %}c_disableBtn_dog{% endif %} button button--full-width {% if show_dynamic_checkout %}button--secondary{% else %}button--primary{% endif %}"
            {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
              disabled
            {% endif %}
          >
            <span>
              {%- if product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="22" viewBox="0 0 25 22" fill="none">
                <g clip-path="url(#clip0_4506_789)">
                  <path d="M10.4669 17.1468C9.15481 17.1468 8.0918 18.1984 8.0918 19.4882C8.0918 20.7781 9.15853 21.8297 10.4669 21.8297C11.7752 21.8297 12.8419 20.7781 12.8419 19.4882C12.8419 18.1984 11.7752 17.1468 10.4669 17.1468ZM10.4669 20.7341C9.77181 20.7341 9.20685 20.1771 9.20685 19.4919C9.20685 18.8067 9.77181 18.2497 10.4669 18.2497C11.1619 18.2497 11.7269 18.8067 11.7269 19.4919C11.7269 20.1771 11.1619 20.7341 10.4669 20.7341Z" fill="white"/>
                  <path d="M19.774 17.1468C18.4619 17.1468 17.3989 18.1984 17.3989 19.4882C17.3989 20.7781 18.4657 21.8297 19.774 21.8297C21.0823 21.8297 22.149 20.7781 22.149 19.4882C22.149 18.1984 21.0823 17.1468 19.774 17.1468ZM19.774 20.7341C19.0789 20.7341 18.514 20.1771 18.514 19.4919C18.514 18.8067 19.0789 18.2497 19.774 18.2497C20.469 18.2497 21.034 18.8067 21.034 19.4919C21.034 20.1771 20.469 20.7341 19.774 20.7341Z" fill="white"/>
                  <path d="M24.6876 4.4135H6.70553L5.89526 1.15233L0.981605 0.177638C0.676824 0.11901 0.383194 0.309551 0.323725 0.610019C0.264256 0.906822 0.457531 1.1963 0.762311 1.25859L4.98464 2.09404L8.44129 16.0145H21.5952C21.9037 16.0145 22.1527 15.769 22.1527 15.4649C22.1527 15.1607 21.9037 14.9152 21.5952 14.9152H9.31103L8.72377 12.5408H22.6247L24.6913 4.41717L24.6876 4.4135ZM8.54536 11.4379C8.51563 11.4379 8.48589 11.4415 8.45616 11.4452L6.98429 5.50911H23.264L21.7587 11.4342H8.54536V11.4379Z" fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_4506_789">
                    <rect width="24.375" height="21.6667" fill="white" transform="translate(0.3125 0.166687)"/>
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="quantity__rules-cart no-js-hidden{% if cart_qty == 0 %} hidden{% endif %}">
              {%- render 'loading-spinner' -%}
            </span>
          </button>
          {%- if show_dynamic_checkout -%}
            {{ form | payment_button }}
          {%- endif -%}
        </div>
    <!-- 猫用お試し -->
        {% elsif product.handle contains 'cat-trial' %}
        <div class="product-form__buttons">
          {%- liquid
            assign check_against_inventory = true
            if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
              assign check_against_inventory = false
            endif
            if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
              assign quantity_rule_soldout = true
            endif
          -%}
          <button
            id="ProductSubmitButton-{{ section_id }}"
            type="submit"
            name="add"
            class="product-form__submit --cat {% if customer.tags contains 'bought-cat-trial' %}c_disableBtn_dog{% endif %} {% if variableCat %}c_disableBtn_cat{% endif %} button button--full-width {% if show_dynamic_checkout %}button--secondary{% else %}button--primary{% endif %}"
            {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
              disabled
            {% endif %}
          >

          
            <span>
              {%- if product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="22" viewBox="0 0 25 22" fill="none">
                <g clip-path="url(#clip0_4506_789)">
                  <path d="M10.4669 17.1468C9.15481 17.1468 8.0918 18.1984 8.0918 19.4882C8.0918 20.7781 9.15853 21.8297 10.4669 21.8297C11.7752 21.8297 12.8419 20.7781 12.8419 19.4882C12.8419 18.1984 11.7752 17.1468 10.4669 17.1468ZM10.4669 20.7341C9.77181 20.7341 9.20685 20.1771 9.20685 19.4919C9.20685 18.8067 9.77181 18.2497 10.4669 18.2497C11.1619 18.2497 11.7269 18.8067 11.7269 19.4919C11.7269 20.1771 11.1619 20.7341 10.4669 20.7341Z" fill="white"/>
                  <path d="M19.774 17.1468C18.4619 17.1468 17.3989 18.1984 17.3989 19.4882C17.3989 20.7781 18.4657 21.8297 19.774 21.8297C21.0823 21.8297 22.149 20.7781 22.149 19.4882C22.149 18.1984 21.0823 17.1468 19.774 17.1468ZM19.774 20.7341C19.0789 20.7341 18.514 20.1771 18.514 19.4919C18.514 18.8067 19.0789 18.2497 19.774 18.2497C20.469 18.2497 21.034 18.8067 21.034 19.4919C21.034 20.1771 20.469 20.7341 19.774 20.7341Z" fill="white"/>
                  <path d="M24.6876 4.4135H6.70553L5.89526 1.15233L0.981605 0.177638C0.676824 0.11901 0.383194 0.309551 0.323725 0.610019C0.264256 0.906822 0.457531 1.1963 0.762311 1.25859L4.98464 2.09404L8.44129 16.0145H21.5952C21.9037 16.0145 22.1527 15.769 22.1527 15.4649C22.1527 15.1607 21.9037 14.9152 21.5952 14.9152H9.31103L8.72377 12.5408H22.6247L24.6913 4.41717L24.6876 4.4135ZM8.54536 11.4379C8.51563 11.4379 8.48589 11.4415 8.45616 11.4452L6.98429 5.50911H23.264L21.7587 11.4342H8.54536V11.4379Z" fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_4506_789">
                    <rect width="24.375" height="21.6667" fill="white" transform="translate(0.3125 0.166687)"/>
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="quantity__rules-cart no-js-hidden{% if cart_qty == 0 %} hidden{% endif %}">
              {%- render 'loading-spinner' -%}
            </span>
          </button>
          {%- if show_dynamic_checkout -%}
            {{ form | payment_button }}
          {%- endif -%}
        </div>

    <!-- その他の商品 -->
        {% else %}
        <div class="product-form__buttons">
          {%- liquid
            assign check_against_inventory = true
            if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
              assign check_against_inventory = false
            endif
            if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
              assign quantity_rule_soldout = true
            endif
          -%}
          <button
            id="ProductSubmitButton-{{ section_id }}"
            type="submit"
            name="add"
            class="product-form__submit button button--full-width {% if show_dynamic_checkout %}button--secondary{% else %}button--primary{% endif %}"
            {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
              disabled
            {% endif %}
          >

            <span>
              {%- if product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="22" viewBox="0 0 25 22" fill="none">
                <g clip-path="url(#clip0_4506_789)">
                  <path d="M10.4669 17.1468C9.15481 17.1468 8.0918 18.1984 8.0918 19.4882C8.0918 20.7781 9.15853 21.8297 10.4669 21.8297C11.7752 21.8297 12.8419 20.7781 12.8419 19.4882C12.8419 18.1984 11.7752 17.1468 10.4669 17.1468ZM10.4669 20.7341C9.77181 20.7341 9.20685 20.1771 9.20685 19.4919C9.20685 18.8067 9.77181 18.2497 10.4669 18.2497C11.1619 18.2497 11.7269 18.8067 11.7269 19.4919C11.7269 20.1771 11.1619 20.7341 10.4669 20.7341Z" fill="white"/>
                  <path d="M19.774 17.1468C18.4619 17.1468 17.3989 18.1984 17.3989 19.4882C17.3989 20.7781 18.4657 21.8297 19.774 21.8297C21.0823 21.8297 22.149 20.7781 22.149 19.4882C22.149 18.1984 21.0823 17.1468 19.774 17.1468ZM19.774 20.7341C19.0789 20.7341 18.514 20.1771 18.514 19.4919C18.514 18.8067 19.0789 18.2497 19.774 18.2497C20.469 18.2497 21.034 18.8067 21.034 19.4919C21.034 20.1771 20.469 20.7341 19.774 20.7341Z" fill="white"/>
                  <path d="M24.6876 4.4135H6.70553L5.89526 1.15233L0.981605 0.177638C0.676824 0.11901 0.383194 0.309551 0.323725 0.610019C0.264256 0.906822 0.457531 1.1963 0.762311 1.25859L4.98464 2.09404L8.44129 16.0145H21.5952C21.9037 16.0145 22.1527 15.769 22.1527 15.4649C22.1527 15.1607 21.9037 14.9152 21.5952 14.9152H9.31103L8.72377 12.5408H22.6247L24.6913 4.41717L24.6876 4.4135ZM8.54536 11.4379C8.51563 11.4379 8.48589 11.4415 8.45616 11.4452L6.98429 5.50911H23.264L21.7587 11.4342H8.54536V11.4379Z" fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_4506_789">
                    <rect width="24.375" height="21.6667" fill="white" transform="translate(0.3125 0.166687)"/>
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="quantity__rules-cart no-js-hidden{% if cart_qty == 0 %} hidden{% endif %}">
              {%- render 'loading-spinner' -%}
            </span>
          </button>
          {%- if show_dynamic_checkout -%}
            {{ form | payment_button }}
          {%- endif -%}
        </div>
        {% endif %} 

      {%- endform -%}
    </product-form>
  {%- else -%}
    <div class="product-form">
      <div class="product-form__buttons form">
        <button
          type="submit"
          name="add"
          class="product-form__submit button button--full-width button--primary"
          disabled
        >
          {{ 'products.product.sold_out' | t }}
        </button>
      </div>
    </div>
  {%- endif -%}

  {%- if show_pickup_availability -%}
    {{ 'component-pickup-availability.css' | asset_url | stylesheet_tag }}

    {%- assign pick_up_availabilities = product.selected_or_first_available_variant.store_availabilities
      | where: 'pick_up_enabled', true
    -%}

    <pickup-availability
      class="product__pickup-availabilities no-js-hidden quick-add-hidden"
      {% if product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %}
        available
      {% endif %}
      data-root-url="{{ routes.root_url }}"
      data-variant-id="{{ product.selected_or_first_available_variant.id }}"
      data-has-only-default-variant="{{ product.has_only_default_variant }}"
      data-product-page-color-scheme="gradient color-{{ section.settings.color_scheme }}"
    >
      <template>
        <pickup-availability-preview class="pickup-availability-preview">
          {% render 'icon-unavailable' %}
          <div class="pickup-availability-info">
            <p class="caption-large">{{ 'products.product.pickup_availability.unavailable' | t }}</p>
            <button class="pickup-availability-button link link--text underlined-link">
              {{ 'products.product.pickup_availability.refresh' | t }}
            </button>
          </div>
        </pickup-availability-preview>
      </template>
    </pickup-availability>

    <script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}
</div>

{% if product.handle contains 'trial' %}
{% if product.handle contains 'dog-trial' %}
<script>
  const buyBtnDog = document.querySelector('.product-form__submit.--dog');
  buyBtnDog.addEventListener('click', function() {
    buyBtnDog.classList.add('c_disableBtn_dog');
  });
</script>
{% endif %}

{% if product.handle contains 'cat-trial' %}
<script>
  const buyBtnCat = document.querySelector('.product-form__submit.--cat');
  buyBtnCat.addEventListener('click', function() {
    buyBtnCat.classList.add('c_disableBtn_cat');
  });
</script>
{% endif %}
{% endif %}
