{% comment %}
  Renders product buy-buttons.
  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} product form id.
  - section_id: {String} id of section to which this snippet belongs.
  - show_pickup_availability: {Boolean} for the pickup availability. If true the pickup availability is rendered, false - not rendered (optional).

  Usage:
  {% render 'buy-buttons', block: block, product: product, product_form_id: product_form_id, section_id: section.id, show_pickup_availability: true %}
{% endcomment %}
<div {{ block.shopify_attributes }}>
  {%- if product != blank -%}
    {%- liquid
      assign gift_card_recipient_feature_active = false
      if block.settings.show_gift_card_recipient and product.gift_card?
        assign gift_card_recipient_feature_active = true
      endif

      assign show_dynamic_checkout = false
      if block.settings.show_dynamic_checkout and gift_card_recipient_feature_active == false
        assign show_dynamic_checkout = true
      endif
    -%}

    <product-form
      class="product-form"
      data-hide-errors="{{ gift_card_recipient_feature_active }}"
      data-section-id="{{ section.id }}"
    >
    
      <div class="product-form__error-message-wrapper" role="alert" hidden>
        <svg
          aria-hidden="true"
          focusable="false"
          class="icon icon-error"
          viewBox="0 0 13 13"
        >
          <circle cx="6.5" cy="6.50049" r="5.5" stroke="white" stroke-width="2"/>
          <circle cx="6.5" cy="6.5" r="5.5" fill="#EB001B" stroke="#EB001B" stroke-width="0.7"/>
          <path d="M5.87413 3.52832L5.97439 7.57216H7.02713L7.12739 3.52832H5.87413ZM6.50076 9.66091C6.88091 9.66091 7.18169 9.37267 7.18169 9.00504C7.18169 8.63742 6.88091 8.34917 6.50076 8.34917C6.12061 8.34917 5.81982 8.63742 5.81982 9.00504C5.81982 9.37267 6.12061 9.66091 6.50076 9.66091Z" fill="white"/>
          <path d="M5.87413 3.17832H5.51535L5.52424 3.537L5.6245 7.58083L5.63296 7.92216H5.97439H7.02713H7.36856L7.37702 7.58083L7.47728 3.537L7.48617 3.17832H7.12739H5.87413ZM6.50076 10.0109C7.06121 10.0109 7.5317 9.57872 7.5317 9.00504C7.5317 8.43137 7.06121 7.99918 6.50076 7.99918C5.94031 7.99918 5.46982 8.43137 5.46982 9.00504C5.46982 9.57872 5.94031 10.0109 6.50076 10.0109Z" fill="white" stroke="#EB001B" stroke-width="0.7">
        </svg>
        <span class="product-form__error-message"></span>
      </div>

      {%- form 'product',
        product,
        id: product_form_id,
        class: 'form',
        novalidate: 'novalidate',
        data-type: 'add-to-cart-form'
      -%}

      {%- comment -%}追記 サブスクリプション{%- endcomment -%}
      {% if content_for_header contains 'mikawaya' %}

        <!-- Mikawaya 商品ページウィジェット ver:3 -->
        {% if product.selling_plan_groups.size > 0 %}
          <style>
            .mikawaya-hidden {
              display: none
            }
            .product__price {
              display: none
            }
            .product-single__price {
              display: none
            }
            .mikawaya-radio-button {
              min-height:auto!important;
            }
            .mikawaya-selling-plan-group-container {
              margin-bottom: 20px;
            }
            .mikawaya-selling-plan-description {
              margin-left: 5px;
              margin-top: 5px;
            }
            .mikawaya-selling-plan-select{
              margin-top: 10px;
            }
            .mikawaya-product-page-widget-container {
              width: 100%
            }
          </style>
          
          <!-- Just for initial use --> 
          {%- liquid
            if product.requires_selling_plan or product.selected_selling_plan_allocation
              assign current_selling_plan_allocation = product.selected_or_first_available_selling_plan_allocation
            else
              assign current_selling_plan_allocation = nil
            endif
            
            if product.selling_plan_groups.size > 1 or product.requires_selling_plan == false
              assign show_fieldset = true
            else 
              assign show_fieldset = false
            endif
          -%}
          
          <div id="mikawaya-product-page-widget-container-v3">
          </div>
          
          <div id="mikawaya-product-page-widget-container" class="mikawaya-hidden mikawaya-product-page-widget-container">
          {% if show_fieldset %}
            <div id="mikawaya-fieldset">
          {% endif %}
          
          {% unless product.requires_selling_plan == true %}
            <label class="c_radio-button" for="one-time-purchase-option">
            <div
              class="mikawaya-selling-plan-group-container c_mikawaya-selling-nomal"
            >
              
                <input 
                  type="radio" 
                  name="purchase_option" 
                  {% if current_selling_plan_allocation == nil %} checked {% endif %}
                  value="one-time"
                  onchange="window.MIKAWAYA.handleSellingPlanGroupChange(event)"
                  class="mikawaya-radio-button"
                  id="one-time-purchase-option"
                >
                  <span class="c_mikawaya-selling-nomal__title">通常の購入</span>
              <div class="c_mikawaya-selling-nomal__price">
                {% for variant in product.variants %}
                  <span 
                    name="one-time-variant-price" 
                    data-variant-id="{{ variant.id }}"
                    {% unless product.selected_or_first_available_variant.id == variant.id %} 
                      class="mikawaya-hidden"
                    {% endunless %}
                    >{{ variant.price | money }}</span><span class="c_in-tax">（税込）</span>
                {% endfor %}
              </div>
            </div>
            </label>
            {% endunless %}
            
            {% for variant in product.variants %}
              {% for selling_plan_allocation in variant.selling_plan_allocations %}
                <div
                  name="variant-group-allocation"
                  data-variant-id="{{ variant.id }}"  
                  data-group-id="{{ selling_plan_allocation.selling_plan_group_id }}"
                  data-selling-plan-id="{{ selling_plan_allocation.selling_plan.id }}"
                  data-selling-plan-allocation-price="{{ selling_plan_allocation.price | money }}"
                  style="display:hidden"
                ></div>
              {% endfor %}
            {% endfor %}
            
            
            <!-- Selling plan groups -->
            {% for group in product.selling_plan_groups %}
              <label class="c_radio-button" for="c_mikawata-radio">
              <div
                name="selling-plan-group-container"
                data-group-id="{{ group.id }}"
                class="mikawaya-selling-plan-group-container mikawaya-hidden c_mikawaya-selling-plan-subscription"
              >
                <div>
                  
                    <input 
                    type="radio" 
                    value="{{ group.id }}" 
                    name="purchase_option"
                    onchange="window.MIKAWAYA.handleSellingPlanGroupChange(event)"
                    class="mikawaya-radio-button"
                    id="c_mikawata-radio"
                    {% if group.id == current_selling_plan_allocation.selling_plan.group_id %} checked {% endif %}
                    {% if product.requires_selling_plan and current_selling_plan_allocation == nil and forloop.first %} checked {% endif %}
                    >
                    <span class="c_mikawaya-selling-plan-subscription__title">{{ group.name }}<span class="c_mikawaya-selling-plan-subscription__title--bg">
                      <svg width="60" height="57" viewBox="0 0 60 57" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <rect width="60" height="57" fill="url(#pattern0)"/>
                        <defs>
                        <pattern id="pattern0" patternContentUnits="objectBoundingBox" width="1" height="1">
                        <use xlink:href="#image0_683_2605" transform="scale(0.00833333 0.00877193)"/>
                        </pattern>
                        <image id="image0_683_2605" width="120" height="114" xlink:href="data:image/png;base64,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"/>
                        </defs>
                        </svg>
                    </span></span>
                  
                  {% for selling_plan in group.selling_plans %}
                    <p 
                      name="selling-plan-description" 
                      data-group-id="{{ group.id }}"
                      data-selling-plan-id="{{ selling_plan.id }}"
                      {% if forloop.first %} 
                        class="mikawaya-selling-plan-description" 
                      {% else %}
                        class="mikawaya-selling-plan-description mikawaya-hidden"
                      {% endif %}
                    >{{ selling_plan.description }}</p>
                  {% endfor %}

                  <div class="c_price-text">1カ月分</div>
                  <span class="c_price" name ="group-inline-price" data-group-id="{{ group.id }}"></span><span class="c_in-tax">（税込）</span>
                </div>
                <select 
                  name="select-selling-plan"
                  data-group-id="{{ group.id }}"
                  onchange="window.MIKAWAYA.handleSellingPlanChange(event)"
                  class="mikawaya-selling-plan-select"
                >
                  <!-- Individual selling plans -->
                  {% for selling_plan in group.selling_plans %}
                    <option value="{{ selling_plan.id }}">{{ selling_plan.name }}</option>
                  {% endfor %}
                </select>
              </div>
              </label>
            {% endfor %}
          {% if show_fieldset %}
            </div>
          {% endif %}
          <input 
            type="hidden" 
            name="selling_plan" 
            value="{{ current_selling_plan_allocation.selling_plan.id }}" 
            id="mikawaya-hidden-selling-plan-id"
          >
          <div 
            type="hidden" 
            id="current-variant-id" 
            data-variant-id="{{ product.selected_or_first_available_variant.id }}" 
            class="mikawaya-hidden"
            >
          </div>
          </div>
        {% endif %}

      {% endif %}

        <input
          type="hidden"
          name="id"
          value="{{ product.selected_or_first_available_variant.id }}"
          {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
            disabled
          {% endif %}
          class="product-variant-id"
        >

        {%- if gift_card_recipient_feature_active -%}
          {%- render 'gift-card-recipient-form', product: product, form: form, section: section -%}
        {%- endif -%}

        {%- comment -%}追記 数量セレクター{%- endcomment -%}
        <div
          id="Quantity-Form-{{ section.id }}"
          class="product-form__input product-form__quantity{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} product-form__quantity-top{% endif %}"
          {{ block.shopify_attributes }}
        >
          {% comment %} TODO: enable theme-check once `item_count_for_variant` is accepted as valid filter {% endcomment %}
          {% # theme-check-disable %}
          {%- assign cart_qty = cart | item_count_for_variant: product.selected_or_first_available_variant.id -%}
          {% # theme-check-enable %}
          <label class="quantity__label form__label" for="Quantity-{{ section.id }}">
            {{ 'products.product.quantity.label' | t }}
          </label>
          <div class="price-per-item__container">
            <quantity-input class="quantity" data-url="{{ product.url }}" data-section="{{ section.id }}">
              <button class="quantity__button no-js-hidden" name="minus" type="button">
                <span class="visually-hidden">
                  {{- 'products.product.quantity.decrease' | t: product: product.title | escape -}}
                </span>
                {% render 'icon-minus' %}
              </button>
              <input
                class="quantity__input"
                type="number"
                name="quantity"
                id="Quantity-{{ section.id }}"
                data-cart-quantity="{{ cart_qty }}"
                data-min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                {% if product.selected_or_first_available_variant.quantity_rule.max != null %}
                  data-max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                  max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                {% endif %}
                step="{{ product.selected_or_first_available_variant.quantity_rule.increment }}"
                value="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                form="{{ product_form_id }}"
              />
              <button class="quantity__button no-js-hidden" name="plus" type="button">
                <span class="visually-hidden">
                  {{- 'products.product.quantity.increase' | t: product: product.title | escape -}}
                </span>
                {% render 'icon-plus' %}
              </button>
            </quantity-input>
            {%- liquid
              assign volume_pricing_array = product.selected_or_first_available_variant.quantity_price_breaks | sort: 'quantity' | reverse
              assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.min
              if cart_qty > 0
                assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.increment
              endif

            -%}
            {%- if product.quantity_price_breaks_configured? -%}
              <price-per-item class="no-js-hidden" id="Price-Per-Item-{{ section.id }}" data-section-id="{{ section.id }}" data-variant-id="{{ product.selected_or_first_available_variant.id }}">
                {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                  {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                  <div class="price-per-item">
                    {%- if variant_price_compare -%}
                      <dl class="price-per-item--current">
                        <dt class="visually-hidden">
                          {{ 'products.product.price.regular_price' | t }}
                        </dt>
                        <dd>
                          <s class="variant-item__old-price">
                            {{ variant_price_compare | money_with_currency }}
                          </s>
                        </dd>
                      </dl>
                    {%- endif -%}
                    {%- if current_qty_for_volume_pricing < volume_pricing_array.last.minimum_quantity -%}
                      {%- assign variant_price = product.selected_or_first_available_variant.price | money_with_currency -%}
                      <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                    {%- else -%}
                      {%- for price_break in volume_pricing_array -%}
                        {%- if current_qty_for_volume_pricing >= price_break.minimum_quantity -%}
                          {%- assign price_break_price = price_break.price | money_with_currency -%}
                          <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: price_break_price }}</span>
                          {%- break -%}
                        {%- endif -%}
                      {%- endfor -%}
                    {%- endif -%}
                  </div>
                {%- else -%}
                  {%- assign variant_price = product.selected_or_first_available_variant.price | money_with_currency -%}
                  {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                  <div class="price-per-item">
                    {%- if variant_price_compare -%}
                      <dl class="price-per-item--current">
                        <dt class="visually-hidden">
                          {{ 'products.product.price.regular_price' | t }}
                        </dt>
                        <dd>
                          <s class="variant-item__old-price">
                            {{ variant_price_compare | money_with_currency }}
                          </s>
                        </dd>
                        <dt class="visually-hidden">
                          {{ 'products.product.price.sale_price' | t }}
                        </dt>
                        <dd>
                          <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                        </dd>
                      </dl>
                    {%- else -%}
                      <span class="price-per-item--current">{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}</span>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </price-per-item>
            {%- endif -%}
          </div>
          <div class="quantity__rules caption no-js-hidden" id="Quantity-Rules-{{ section.id }}">
            {%- if product.selected_or_first_available_variant.quantity_rule.increment > 1 -%}
              <span class="divider">
                {{-
                  'products.product.quantity.multiples_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.increment
                -}}
              </span>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.quantity_rule.min > 1 -%}
              <span class="divider">
                {{-
                  'products.product.quantity.minimum_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.min
                -}}
              </span>
            {%- endif -%}
            {%- if product.selected_or_first_available_variant.quantity_rule.max != null -%}
              <span class="divider">
                {{-
                  'products.product.quantity.maximum_of'
                  | t: quantity: product.selected_or_first_available_variant.quantity_rule.max
                -}}
              </span>
            {%- endif -%}
          </div>
          {%- if product.quantity_price_breaks_configured? -%}
            <volume-pricing class="parent-display no-js-hidden" id="Volume-{{ section.id }}">
              {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                <span class="caption-large">{{ 'products.product.volume_pricing.title' | t }}</span>
                <ul class="list-unstyled no-js-hidden">
                  <li>
                    <span>{{ product.selected_or_first_available_variant.quantity_rule.min }}+</span>
                    {%- assign price = product.selected_or_first_available_variant.price | money_with_currency -%}
                    <span data-text="{{ 'products.product.volume_pricing.price_at_each' | t: price: variant_price }}">{{ 'sections.quick_order_list.each' | t: money: price }}</span>
                  </li>
                  {%- for price_break in product.selected_or_first_available_variant.quantity_price_breaks -%}
                    {%- assign price_break_price = price_break.price | money_with_currency -%}
                    <li class="{%- if forloop.index >= 3 -%}show-more-item hidden{%- endif -%}">
                      <span>{{ price_break.minimum_quantity }}<span aria-hidden="true">+</span></span>
                      <span data-text="{{ 'products.product.volume_pricing.price_at_each' | t: price: price_break_price }}">{{ 'sections.quick_order_list.each' | t: money: price_break_price }}</span>
                    </li>
                  {%- endfor -%}
                </ul>
                {%- if product.selected_or_first_available_variant.quantity_price_breaks.size >= 3 -%}
                  <show-more-button>
                    <button
                      class="button-show-more link underlined-link"
                      id="Show-More-{{ section.id }}"
                      type="button"
                    >
                      <span class="label-show-more label-text"
                        ><span aria-hidden="true">+ </span>{{ 'products.facets.show_more' | t }}
                      </span>
                    </button>
                  </show-more-button>
              {%- endif -%}
            {%- endif -%}
            </volume-pricing>
          {%- endif -%}
        </div>

        <div class="product-form__buttons">
          {%- liquid
            assign check_against_inventory = true
            if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
              assign check_against_inventory = false
            endif
            if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity and check_against_inventory
              assign quantity_rule_soldout = true
            endif
          -%}
          <button
            id="ProductSubmitButton-{{ section_id }}"
            type="submit"
            name="add"
            class="product-form__submit button button--full-width {% if show_dynamic_checkout %}button--secondary{% else %}button--primary{% endif %}"
            {% if product.selected_or_first_available_variant.available == false or quantity_rule_soldout %}
              disabled
            {% endif %}
          >

            <span>
              {%- if product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                {{ 'products.product.sold_out' | t }}
              {%- else -%}
                {{ 'products.product.add_to_cart' | t }}
              {%- endif -%}
            </span>
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="25" height="22" viewBox="0 0 25 22" fill="none">
                <g clip-path="url(#clip0_4506_789)">
                  <path d="M10.4669 17.1468C9.15481 17.1468 8.0918 18.1984 8.0918 19.4882C8.0918 20.7781 9.15853 21.8297 10.4669 21.8297C11.7752 21.8297 12.8419 20.7781 12.8419 19.4882C12.8419 18.1984 11.7752 17.1468 10.4669 17.1468ZM10.4669 20.7341C9.77181 20.7341 9.20685 20.1771 9.20685 19.4919C9.20685 18.8067 9.77181 18.2497 10.4669 18.2497C11.1619 18.2497 11.7269 18.8067 11.7269 19.4919C11.7269 20.1771 11.1619 20.7341 10.4669 20.7341Z" fill="white"/>
                  <path d="M19.774 17.1468C18.4619 17.1468 17.3989 18.1984 17.3989 19.4882C17.3989 20.7781 18.4657 21.8297 19.774 21.8297C21.0823 21.8297 22.149 20.7781 22.149 19.4882C22.149 18.1984 21.0823 17.1468 19.774 17.1468ZM19.774 20.7341C19.0789 20.7341 18.514 20.1771 18.514 19.4919C18.514 18.8067 19.0789 18.2497 19.774 18.2497C20.469 18.2497 21.034 18.8067 21.034 19.4919C21.034 20.1771 20.469 20.7341 19.774 20.7341Z" fill="white"/>
                  <path d="M24.6876 4.4135H6.70553L5.89526 1.15233L0.981605 0.177638C0.676824 0.11901 0.383194 0.309551 0.323725 0.610019C0.264256 0.906822 0.457531 1.1963 0.762311 1.25859L4.98464 2.09404L8.44129 16.0145H21.5952C21.9037 16.0145 22.1527 15.769 22.1527 15.4649C22.1527 15.1607 21.9037 14.9152 21.5952 14.9152H9.31103L8.72377 12.5408H22.6247L24.6913 4.41717L24.6876 4.4135ZM8.54536 11.4379C8.51563 11.4379 8.48589 11.4415 8.45616 11.4452L6.98429 5.50911H23.264L21.7587 11.4342H8.54536V11.4379Z" fill="white"/>
                </g>
                <defs>
                  <clipPath id="clip0_4506_789">
                    <rect width="24.375" height="21.6667" fill="white" transform="translate(0.3125 0.166687)"/>
                  </clipPath>
                </defs>
              </svg>
            </span>
            <span class="quantity__rules-cart no-js-hidden{% if cart_qty == 0 %} hidden{% endif %}">
              {%- render 'loading-spinner' -%}
            </span>
          </button>
          {%- if show_dynamic_checkout -%}
            {{ form | payment_button }}
          {%- endif -%}
        </div>
      {%- endform -%}
    </product-form>
  {%- else -%}
    <div class="product-form">
      <div class="product-form__buttons form">
        <button
          type="submit"
          name="add"
          class="product-form__submit button button--full-width button--primary"
          disabled
        >
          {{ 'products.product.sold_out' | t }}
        </button>
      </div>
    </div>
  {%- endif -%}

  {%- if show_pickup_availability -%}
    {{ 'component-pickup-availability.css' | asset_url | stylesheet_tag }}

    {%- assign pick_up_availabilities = product.selected_or_first_available_variant.store_availabilities
      | where: 'pick_up_enabled', true
    -%}

    <pickup-availability
      class="product__pickup-availabilities no-js-hidden quick-add-hidden"
      {% if product.selected_or_first_available_variant.available and pick_up_availabilities.size > 0 %}
        available
      {% endif %}
      data-root-url="{{ routes.root_url }}"
      data-variant-id="{{ product.selected_or_first_available_variant.id }}"
      data-has-only-default-variant="{{ product.has_only_default_variant }}"
      data-product-page-color-scheme="gradient color-{{ section.settings.color_scheme }}"
    >
      <template>
        <pickup-availability-preview class="pickup-availability-preview">
          {% render 'icon-unavailable' %}
          <div class="pickup-availability-info">
            <p class="caption-large">{{ 'products.product.pickup_availability.unavailable' | t }}</p>
            <button class="pickup-availability-button link link--text underlined-link">
              {{ 'products.product.pickup_availability.refresh' | t }}
            </button>
          </div>
        </pickup-availability-preview>
      </template>
    </pickup-availability>

    <script src="{{ 'pickup-availability.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}
</div>
